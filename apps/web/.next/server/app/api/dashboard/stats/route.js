(()=>{var e={};e.id=694,e.ids=[694],e.modules={6330:e=>{"use strict";e.exports=require("@prisma/client")},846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},5511:e=>{"use strict";e.exports=require("crypto")},9248:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>x,routeModule:()=>l,serverHooks:()=>y,workAsyncStorage:()=>h,workUnitAsyncStorage:()=>m});var s={};r.r(s),r.d(s,{GET:()=>d,dynamic:()=>p});var a=r(1271),n=r(1232),o=r(8079),i=r(1238),u=r(9201),c=r(9206);let p="force-dynamic";async function d(){try{let e=await (0,c.j2)();if(!e?.user)return i.NextResponse.json({error:"Non autoris\xe9"},{status:401});let t=new Date;t.setHours(0,0,0,0);let r=(await u.z.transaction.findMany({where:{type:"SALE",createdAt:{gte:t},status:"COMPLETED"}})).reduce((e,t)=>e+Number(t.amount),0),s=await u.z.product.findMany({include:{batches:{where:{quantity:{gt:0}}}}}),a=0,n=0;s.forEach(e=>{let t=e.batches.reduce((e,t)=>e+t.quantity,0);t<=0&&n++,a+=t*Number(e.sellingPrice)});let o=new Date;o.setDate(o.getDate()+30);let p=await u.z.batch.findMany({where:{quantity:{gt:0},expiryDate:{gt:new Date,lte:o}},include:{product:!0}});return i.NextResponse.json({revenueToday:r,stockValue:a,stockCount:s.length,outOfStockCount:n,expiringBatches:p.map(e=>({productName:e.product.name,batchNumber:e.batchNumber,expiryDate:e.expiryDate.toISOString(),quantity:e.quantity}))})}catch(e){return console.error("Dashboard Stats Error:",e),i.NextResponse.json({error:e.message},{status:500})}}let l=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/dashboard/stats/route",pathname:"/api/dashboard/stats",filename:"route",bundlePath:"app/api/dashboard/stats/route"},resolvedPagePath:"C:\\Users\\tinkpad\\Desktop\\Mes Nouveaux Projets\\Sahel Ubuntu Pharm\\apps\\web\\app\\api\\dashboard\\stats\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:h,workUnitAsyncStorage:m,serverHooks:y}=l;function x(){return(0,o.patchFetch)({workAsyncStorage:h,workUnitAsyncStorage:m})}},7032:()=>{},408:()=>{},9206:(e,t,r)=>{"use strict";r.d(t,{j2:()=>c,Y9:()=>l});var s=r(8481),a=r(1041),n=r(9201),o=r(8483),i=r(7334);async function u(e){try{return await n.z.user.findUnique({where:{email:e}})}catch(e){throw console.error("Failed to fetch user:",e),Error("Failed to fetch user.")}}let{auth:c,signIn:p,signOut:d,handlers:l}=(0,s.Ay)({pages:{signIn:"/login"},callbacks:{authorized({auth:e,request:{nextUrl:t}}){let r=!!e?.user;return!(t.pathname.startsWith("/dashboard")||t.pathname.startsWith("/pos")||t.pathname.startsWith("/inventory"))||!!r},session:async({session:e,token:t})=>(t.sub&&e.user&&(e.user.id=t.sub),t.role&&e.user&&(e.user.role=t.role),e),jwt:async({token:e,user:t})=>(t&&(e.role=t.role),e)},session:{strategy:"jwt",maxAge:86400},useSecureCookies:!0,cookies:{sessionToken:{name:"__Secure-next-auth.session-token",options:{httpOnly:!0,sameSite:"lax",path:"/",secure:!0}}},providers:[],providers:[(0,a.A)({async authorize(e){let t=i.Ikc({email:i.YjP().email(),password:i.YjP().min(6)}).safeParse(e);if(t.success){let{email:e,password:r}=t.data,s=await u(e);if(!s)return null;if(await o.Ay.compare(r,s.password))return s}return console.log("Invalid credentials"),null}})]})},9201:(e,t,r)=>{"use strict";r.d(t,{z:()=>a});var s=r(6330);let a=globalThis.prisma??new s.PrismaClient({log:["error"]})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[207,48,483,150],()=>r(9248));module.exports=s})();