(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[807],{9084:(e,r,t)=>{Promise.resolve().then(t.bind(t,8995))},8995:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>g});var a=t(4568),s=t(7620),i=t(6550),n=t(4414);let l=(0,n.A)("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]),o=(0,n.A)("ScanBarcode",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M8 7v10",key:"23sfjj"}],["path",{d:"M12 7v10",key:"jspqdw"}],["path",{d:"M17 7v10",key:"578dap"}]]),d=(0,n.A)("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);var c=t(3418),u=t(7500),f=t(6857),p=t(6511),m=t(1965),x=t(9854),h=t(5859),v=t(4260);function y(){let[e,r]=(0,s.useState)(""),[t,n]=(0,s.useState)([]),[y,g]=(0,s.useState)([]),[b,j]=(0,s.useState)(!0),N=(0,s.useRef)(null);async function w(){try{let e=await fetch("/api/products");if(e.ok){let r=(await e.json()).map(e=>({id:e.id,name:e.name,price:e.sellingPrice,stock:e.stock}));g(r)}}catch(e){console.error("Erreur chargement produits",e)}finally{j(!1)}}(0,s.useEffect)(()=>{w()},[]);let k=y.filter(r=>r.name.toLowerCase().includes(e.toLowerCase())),C=e=>{if(e.stock<=0){alert("Rupture de stock !");return}n(r=>{let t=r.find(r=>r.id===e.id);return t?t.quantity>=e.stock?(alert("Stock insuffisant pour ajouter plus !"),r):r.map(r=>r.id===e.id?{...r,quantity:r.quantity+1}:r):[...r,{...e,quantity:1}]})},S=(e,r)=>{n(t=>t.map(t=>{if(t.id===e){let e=t.quantity+r;return e<=0?null:{...t,quantity:e}}return t}).filter(Boolean))},R=t.reduce((e,r)=>e+r.price*r.quantity,0),q=async()=>{if(0!==t.length)try{let e={items:t.map(e=>({productId:e.id,quantity:e.quantity,sellingPrice:e.price})),paymentMethod:"CASH"},r=await fetch("/api/sales",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),a=await r.json();if(!r.ok)throw Error(a.error||"Erreur transaction");window.open("/pos/print/".concat(a.transactionId),"_blank"),n([]),w()}catch(e){alert("Erreur lors de la vente: "+e.message)}};return(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 h-[calc(100vh-100px)]",children:[(0,a.jsxs)("div",{className:"md:col-span-2 space-y-4 flex flex-col h-full",children:[(0,a.jsx)("div",{className:"flex gap-2",children:(0,a.jsxs)("div",{className:"relative flex-1",children:[(0,a.jsx)(i.A,{className:"absolute left-3 top-3 h-5 w-5 text-muted-foreground"}),(0,a.jsx)(f.p,{ref:N,placeholder:"Scanner ou chercher (DCI, Nom)...",className:"pl-10 text-lg py-6",autoFocus:!0,value:e,onChange:e=>r(e.target.value)})]})}),(0,a.jsx)(x.F,{className:"flex-1 border rounded-md p-4 bg-white/50",children:b?(0,a.jsx)("div",{className:"p-10 text-center",children:"Chargement..."}):(0,a.jsx)("div",{className:"grid grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:k.map(e=>(0,a.jsx)(m.Zp,{className:"cursor-pointer hover:border-primary transition-colors ".concat(0===e.stock?"opacity-50 grayscale":""),onClick:()=>C(e),children:(0,a.jsxs)(m.Wu,{className:"p-4 text-center space-y-2",children:[(0,a.jsx)("div",{className:"font-bold truncate",title:e.name,children:e.name}),(0,a.jsxs)("div",{className:"text-primary font-mono font-bold text-lg",children:[e.price.toLocaleString()," F"]}),(0,a.jsxs)(h.E,{variant:e.stock>10?"secondary":"destructive",children:["Stock: ",e.stock]})]})},e.id))})})]}),(0,a.jsxs)(m.Zp,{className:"flex flex-col h-full border-l-4 border-l-primary shadow-xl",children:[(0,a.jsx)(m.aR,{className:"border-b bg-muted/20",children:(0,a.jsxs)(m.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(l,{className:"h-5 w-5"}),"Panier en cours"]})}),(0,a.jsx)(x.F,{className:"flex-1 p-4",children:0===t.length?(0,a.jsxs)("div",{className:"h-full flex flex-col items-center justify-center text-muted-foreground space-y-4 opacity-50",children:[(0,a.jsx)(o,{className:"h-16 w-16"}),(0,a.jsx)("p",{children:"En attente de produits..."})]}):(0,a.jsx)("div",{className:"space-y-4",children:t.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between bg-white p-3 rounded-lg shadow-sm border",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"font-medium text-sm",children:e.name}),(0,a.jsxs)("div",{className:"text-xs text-muted-foreground",children:[e.price," x ",e.quantity]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(p.$,{size:"icon",variant:"outline",className:"h-8 w-8",onClick:()=>S(e.id,-1),children:(0,a.jsx)(d,{className:"h-3 w-3"})}),(0,a.jsx)("span",{className:"w-8 text-center font-bold",children:e.quantity}),(0,a.jsx)(p.$,{size:"icon",variant:"outline",className:"h-8 w-8",onClick:()=>S(e.id,1),children:(0,a.jsx)(c.A,{className:"h-3 w-3"})})]}),(0,a.jsx)("div",{className:"ml-4 font-bold min-w-[60px] text-right",children:(e.price*e.quantity).toLocaleString()})]},e.id))})}),(0,a.jsxs)("div",{className:"p-6 bg-muted/10 border-t space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Total HT"}),(0,a.jsxs)("span",{children:[R.toLocaleString()," F"]})]}),(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"TVA (0%)"}),(0,a.jsx)("span",{children:"0 F"})]}),(0,a.jsx)(v.w,{className:"my-2"}),(0,a.jsxs)("div",{className:"flex justify-between text-2xl font-bold text-primary",children:[(0,a.jsx)("span",{children:"Net \xe0 Payer"}),(0,a.jsxs)("span",{children:[R.toLocaleString()," FCFA"]})]})]}),(0,a.jsxs)(p.$,{size:"lg",className:"w-full h-14 text-xl font-bold shadow-lg hover:scale-105 transition-transform",disabled:0===t.length,onClick:q,children:[(0,a.jsx)(u.A,{className:"mr-2 h-6 w-6"}),"ENCAISSER"]})]})]})]})}function g(){return(0,a.jsx)("div",{className:"flex-1 p-6 h-[calc(100vh-64px)] overflow-hidden",children:(0,a.jsx)(y,{})})}},5859:(e,r,t)=>{"use strict";t.d(r,{E:()=>l});var a=t(4568);t(7620);var s=t(3686),i=t(3772);let n=(0,s.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function l(e){let{className:r,variant:t,...s}=e;return(0,a.jsx)("div",{className:(0,i.cn)(n({variant:t}),r),...s})}},6511:(e,r,t)=>{"use strict";t.d(r,{$:()=>d});var a=t(4568),s=t(7620),i=t(7680),n=t(3686),l=t(3772);let o=(0,n.F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=s.forwardRef((e,r)=>{let{className:t,variant:s,size:n,asChild:d=!1,...c}=e,u=d?i.DX:"button";return(0,a.jsx)(u,{className:(0,l.cn)(o({variant:s,size:n,className:t})),ref:r,...c})});d.displayName="Button"},1965:(e,r,t)=>{"use strict";t.d(r,{BT:()=>d,Wu:()=>c,ZB:()=>o,Zp:()=>n,aR:()=>l,wL:()=>u});var a=t(4568),s=t(7620),i=t(3772);let n=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("div",{ref:r,className:(0,i.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...s})});n.displayName="Card";let l=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("div",{ref:r,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",t),...s})});l.displayName="CardHeader";let o=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("h3",{ref:r,className:(0,i.cn)("text-2xl font-semibold leading-none tracking-tight",t),...s})});o.displayName="CardTitle";let d=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("p",{ref:r,className:(0,i.cn)("text-sm text-muted-foreground",t),...s})});d.displayName="CardDescription";let c=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("div",{ref:r,className:(0,i.cn)("p-6 pt-0",t),...s})});c.displayName="CardContent";let u=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("div",{ref:r,className:(0,i.cn)("flex items-center p-6 pt-0",t),...s})});u.displayName="CardFooter"},6857:(e,r,t)=>{"use strict";t.d(r,{p:()=>n});var a=t(4568),s=t(7620),i=t(3772);let n=s.forwardRef((e,r)=>{let{className:t,type:s,...n}=e;return(0,a.jsx)("input",{type:s,className:(0,i.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:r,...n})});n.displayName="Input"},9854:(e,r,t)=>{"use strict";t.d(r,{F:()=>l});var a=t(4568),s=t(7620),i=t(1727),n=t(3772);let l=s.forwardRef((e,r)=>{let{className:t,children:s,...l}=e;return(0,a.jsxs)(i.bL,{ref:r,className:(0,n.cn)("relative overflow-hidden",t),...l,children:[(0,a.jsx)(i.LM,{className:"h-full w-full rounded-[inherit]",children:s}),(0,a.jsx)(o,{}),(0,a.jsx)(i.OK,{})]})});l.displayName=i.bL.displayName;let o=s.forwardRef((e,r)=>{let{className:t,orientation:s="vertical",...l}=e;return(0,a.jsx)(i.VM,{ref:r,orientation:s,className:(0,n.cn)("flex touch-none select-none transition-colors","vertical"===s&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===s&&"h-2.5 border-t border-t-transparent p-[1px]",t),...l,children:(0,a.jsx)(i.lr,{className:"relative flex-1 rounded-full bg-border"})})});o.displayName=i.VM.displayName},4260:(e,r,t)=>{"use strict";t.d(r,{w:()=>l});var a=t(4568),s=t(7620),i=t(4861),n=t(3772);let l=s.forwardRef((e,r)=>{let{className:t,orientation:s="horizontal",decorative:l=!0,...o}=e;return(0,a.jsx)(i.b,{ref:r,decorative:l,orientation:s,className:(0,n.cn)("shrink-0 bg-border","horizontal"===s?"h-[1px] w-full":"h-full w-[1px]",t),...o})});l.displayName=i.b.displayName},3772:(e,r,t)=>{"use strict";t.d(r,{cn:()=>i});var a=t(5928),s=t(6564);function i(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,s.QP)((0,a.$)(r))}},7307:(e,r,t)=>{"use strict";t.d(r,{sG:()=>n});var a=t(7620);t(7509);var s=t(7680),i=t(4568),n=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,r)=>{let t=(0,s.TL)(`Primitive.${r}`),n=a.forwardRef((e,a)=>{let{asChild:s,...n}=e,l=s?t:r;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,i.jsx)(l,{...n,ref:a})});return n.displayName=`Primitive.${r}`,{...e,[r]:n}},{})},4861:(e,r,t)=>{"use strict";t.d(r,{b:()=>d});var a=t(7620),s=t(7307),i=t(4568),n="horizontal",l=["horizontal","vertical"],o=a.forwardRef((e,r)=>{let{decorative:t,orientation:a=n,...o}=e,d=l.includes(a)?a:n;return(0,i.jsx)(s.sG.div,{"data-orientation":d,...t?{role:"none"}:{"aria-orientation":"vertical"===d?d:void 0,role:"separator"},...o,ref:r})});o.displayName="Separator";var d=o},3418:(e,r,t)=>{"use strict";t.d(r,{A:()=>a});let a=(0,t(4414).A)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},6550:(e,r,t)=>{"use strict";t.d(r,{A:()=>a});let a=(0,t(4414).A)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])}},e=>{var r=r=>e(e.s=r);e.O(0,[350,461,582,587,855,358],()=>r(9084)),_N_E=e.O()}]);